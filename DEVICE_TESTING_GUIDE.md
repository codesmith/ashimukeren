# 実機最終動作確認ガイド

**プロジェクト**: あしむけれん (Respectful Direction Tracker)
**タスク**: T-D1.4.1
**目的**: App Store/Play Store公開前の最終動作確認

---

## 🎯 概要

App Store/Play Store公開前に、実機でアプリの全機能を最終確認します。この段階で問題を発見することで、審査拒否やユーザーからの低評価を防ぎます。

---

## 📋 準備

### テストデバイス

- **Android**:
  - 最低1台（できれば2台以上、異なるOSバージョン）
  - 推奨: Android 10以上
  - 推奨: 異なる画面サイズ（例: スマートフォン、タブレット）

- **iOS**:
  - 最低1台（実機必須）
  - 推奨: iOS 15以上
  - 推奨: iPhone（App StoreはiPhoneアプリとして公開）

### ビルド

- **Android**: Release APK（署名済み）
  ```bash
  flutter build apk --release
  # または
  flutter build appbundle --release
  ```

- **iOS**: Xcodeで Archive ビルド（またはDebugビルド）
  ```bash
  flutter run --release -d <iPhone-device-id>
  ```

---

## 🧪 テストシナリオ

### User Story 1: 人物登録機能（Registration）

#### テストケース1.1: 新規登録（正常系）

1. **操作**: アプリ起動 → 登録一覧画面の「新規登録」ボタンをタップ
2. **入力**:
   - 名前: `テスト太郎`
   - 住所: `東京都渋谷区渋谷1-1-1`
3. **操作**: 「登録」ボタンをタップ
4. **期待結果**:
   - ✅ スナックバー「登録しました」が表示される
   - ✅ 登録一覧画面に戻る
   - ✅ リストに「テスト太郎」が表示される
   - ✅ 「位置情報あり」と表示される（住所から座標変換成功）

#### テストケース1.2: 新規登録（無効な住所）

1. **操作**: 新規登録画面で以下を入力
   - 名前: `無効太郎`
   - 住所: `存在しない住所12345`
2. **操作**: 「登録」ボタンをタップ
3. **期待結果**:
   - ✅ スナックバー「住所の位置情報を取得できませんでした」が表示される
   - ✅ 登録一覧画面に戻る
   - ✅ リストに「無効太郎」が表示される
   - ✅ 「位置情報なし」と表示される

#### テストケース1.3: 登録削除

1. **操作**: 登録一覧画面で「テスト太郎」の削除ボタン（ゴミ箱アイコン）をタップ
2. **期待結果**:
   - ✅ 削除確認ダイアログが表示される
   - ✅ 「削除」をタップすると「テスト太郎」がリストから消える

---

### User Story 2: 地図表示機能（Map）

#### テストケース2.1: 地図画面表示

1. **前提**: 少なくとも1人が登録されており、位置情報がある
2. **操作**: 登録一覧画面で「地図」アイコンをタップ
3. **期待結果**:
   - ✅ Google Maps画面が表示される
   - ✅ 登録された人物の位置に赤いピンが表示される
   - ✅ 現在地（青い丸）が表示される
   - ✅ 画面上部に「X人を地図上に表示」と表示される
   - ✅ カメラが全ピン+現在地を含むように自動調整される

#### テストケース2.2: 位置情報なしの人物

1. **前提**: 位置情報なしの人物が登録されている
2. **操作**: 地図画面を表示
3. **期待結果**:
   - ✅ 位置情報ありの人物のみピン表示
   - ✅ 位置情報なしの人物はピン表示されない

#### テストケース2.3: リストアイテムから地図遷移

1. **操作**: 登録一覧画面でリストアイテムをタップ
2. **期待結果**:
   - ✅ 地図画面に遷移する
   - ✅ タップした人物の位置にピンが表示される

---

### User Story 3: コンパス方向警告機能（Compass）

#### テストケース3.1: コンパス画面表示（スマホ水平）

1. **前提**: 少なくとも1人が登録されており、位置情報がある
2. **操作**: 登録一覧画面で「コンパス」アイコンをタップ
3. **操作**: スマホを水平に持つ
4. **期待結果**:
   - ✅ コンパス画面が表示される
   - ✅ コンパスローズ（N/E/S/W）が表示される
   - ✅ 登録された人物の方向インジケーターが表示される（名前ラベル付き）
   - ✅ 画面下部に「X人登録済み」と表示される
   - ✅ GPS精度が表示される（例: 「GPS精度: 10.0m」）

#### テストケース3.2: 方向警告（赤色）

1. **操作**: コンパス画面でスマホの上部を登録された人物の方向に向ける
2. **期待結果**:
   - ✅ 背景色が赤色に変わる
   - ✅ 画面上部に警告メッセージが表示される（例: 「テスト太郎さんの方向です！」）
   - ✅ 警告アイコンが表示される

#### テストケース3.3: 安全方向（緑色）

1. **操作**: スマホの上部を登録された人物とは異なる方向に向ける
2. **期待結果**:
   - ✅ 背景色が緑色に変わる
   - ✅ 「足を向けて寝ることができる方角です！」メッセージが表示される
   - ✅ チェックマークアイコンが表示される

#### テストケース3.4: スマホ非水平時

1. **操作**: スマホを垂直（縦持ち）または傾けて持つ
2. **期待結果**:
   - ✅ 背景色がグレー（ニュートラル）に変わる
   - ✅ 「スマホを水平に持ってください」メッセージが表示される
   - ✅ コンパスローズは表示されるが、方向インジケーターは表示されない

---

### 追加テスト項目

#### テストケース4.1: 位置情報権限（初回起動）

1. **操作**: アプリをアンインストール → 再インストール → 起動
2. **期待結果**:
   - ✅ 位置情報権限リクエストダイアログが表示される
   - ✅ 「常に許可」または「アプリ使用中のみ」を選択できる
   - ✅ 「許可しない」を選択した場合、地図・コンパス機能で警告が表示される

#### テストケース4.2: バックグラウンド復帰

1. **操作**: アプリを開いた状態でホームボタン → 他のアプリを開く → アプリに戻る
2. **期待結果**:
   - ✅ アプリが正常に復帰する
   - ✅ 前回の画面状態が保持されている
   - ✅ クラッシュしない

#### テストケース4.3: ネットワークエラー

1. **操作**: 機内モードをON → 新規登録画面で住所入力 → 「登録」をタップ
2. **期待結果**:
   - ✅ スナックバー「ネットワークエラー：住所の位置情報を取得できませんでした」が表示される
   - ✅ アプリがクラッシュしない

#### テストケース4.4: 大量データテスト

1. **操作**: 10人以上を登録（異なる住所）
2. **操作**: 地図画面を開く
3. **期待結果**:
   - ✅ すべてのピンが表示される
   - ✅ カメラが全ピンを含むように調整される
   - ✅ 地図の動作がスムーズ（フレームドロップなし）

#### テストケース4.5: アプリ名・アイコン確認

1. **操作**: ホーム画面でアプリアイコンを確認
2. **期待結果**:
   - ✅ アプリ名が「あしむけれん」と表示される
   - ✅ アイコンがカスタムアイコンになっている（デフォルトFlutterアイコンでない）

---

## 📸 スクリーンショット撮影

App Store/Play Storeの掲載ページで使用するスクリーンショットを撮影します。

### Android（Play Store用）

**要件**:
- 最低2枚、最大8枚
- 形式: JPEGまたは24-bit PNG
- サイズ: 最小320px、最大3840px
- アスペクト比: 16:9または9:16

**推奨スクリーンショット**:
1. 📱 登録一覧画面（3人程度登録済み）
2. 📱 新規登録画面（入力例あり）
3. 📱 地図画面（複数の赤いピン表示）
4. 📱 コンパス画面（緑色・安全方向）
5. 📱 コンパス画面（赤色・警告表示）

### iOS（App Store用）

**要件**:
- 最低1枚、最大10枚
- 形式: JPEGまたはPNG
- サイズ: デバイスに応じて異なる
  - iPhone 6.7" (iPhone 16 Plus): 1320 x 2868 px
  - iPhone 6.5" (iPhone 14 Pro Max): 1290 x 2796 px

**推奨スクリーンショット**:
- Androidと同じ5枚

**撮影方法**:
- iPhone: サイドボタン + 音量アップボタン
- Android: 電源ボタン + 音量ダウンボタン
- またはシミュレータ/エミュレータのスクリーンショット機能

---

## ✅ 最終確認チェックリスト

### 機能テスト

- [ ] US1: 人物登録機能
  - [ ] 新規登録（正常系）
  - [ ] 新規登録（無効な住所）
  - [ ] 登録削除
- [ ] US2: 地図表示機能
  - [ ] 地図画面表示
  - [ ] 位置情報なしの人物
  - [ ] リストアイテムから地図遷移
- [ ] US3: コンパス方向警告機能
  - [ ] コンパス画面表示（スマホ水平）
  - [ ] 方向警告（赤色）
  - [ ] 安全方向（緑色）
  - [ ] スマホ非水平時

### 追加テスト

- [ ] 位置情報権限リクエスト
- [ ] バックグラウンド復帰
- [ ] ネットワークエラー処理
- [ ] 大量データテスト（10人以上）
- [ ] アプリ名・アイコン確認

### スクリーンショット

- [ ] 登録一覧画面（3人程度登録済み）
- [ ] 新規登録画面（入力例あり）
- [ ] 地図画面（複数の赤いピン表示）
- [ ] コンパス画面（緑色・安全方向）
- [ ] コンパス画面（赤色・警告表示）

### パフォーマンス

- [ ] アプリ起動時間: 3秒以内
- [ ] 画面遷移: スムーズ（フレームドロップなし）
- [ ] センサー応答: 50ms以内（コンパス画面）
- [ ] メモリ使用量: 適切（バックグラウンドでメモリリークなし）

### クラッシュ・エラー

- [ ] テスト中にクラッシュが発生しない
- [ ] エラーメッセージが適切に表示される
- [ ] ネットワークエラーが適切に処理される

---

## 🐞 バグ発見時の対応

バグを発見した場合、以下の情報を記録してください：

1. **再現手順**: バグが発生する操作手順
2. **期待結果**: 正常な動作
3. **実際の結果**: バグの詳細
4. **環境情報**:
   - デバイス名（例: iPhone 16 Plus、Pixel 8）
   - OSバージョン（例: iOS 18.0、Android 14）
   - アプリバージョン（例: 1.0.0）
5. **スクリーンショット**: バグが発生した画面

**バグ修正後**: 再度このテストガイドを実行し、すべてのテストケースが合格することを確認してください。

---

## 📊 テスト結果レポート

### テスト実施日

- **Android**: _______________________
- **iOS**: _______________________

### テスト担当者

- _______________________

### テスト結果

- **合格**: _____ / _____ テストケース
- **不合格**: _____ / _____ テストケース
- **保留**: _____ / _____ テストケース

### 発見されたバグ

1. _______________________
2. _______________________
3. _______________________

### 修正済みバグ

1. _______________________
2. _______________________
3. _______________________

### 公開判定

- [ ] **公開可能**: すべてのテストケースが合格
- [ ] **公開保留**: 重大なバグが存在
- [ ] **再テスト必要**: バグ修正後に再テスト

---

## 📞 トラブルシューティング

### 問題1: 地図が表示されない

**原因**: API制限の設定ミス、またはAPIキーが無効

**解決策**:
1. Google Cloud ConsoleでAPI制限を確認（GOOGLE_CLOUD_SETUP_GUIDE.md参照）
2. SHA-1フィンガープリントが正しく登録されているか確認
3. `flutter clean && flutter pub get` を実行してリビルド

### 問題2: コンパスが動かない

**原因**: シミュレータではコンパスが動作しない

**解決策**:
- 実機でテストしてください（iPhone/Androidの実機）

### 問題3: 位置情報が取得できない

**原因**: 位置情報権限が拒否されている

**解決策**:
- 設定 → あしむけれん → 位置情報 → 「常に許可」または「アプリ使用中のみ」に変更

---

**完了日**: _______________________
**確認者**: _______________________
**次のステップ**: Phase D2 (Android Play Store Release) または Phase D3 (iOS App Store Release)

